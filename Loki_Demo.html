<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LOKI v4.0 - Sistema Completo 28 Estrat√©gias</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #0f3460 100%);
      color: #ffffff;
      min-height: 100vh;
      padding: 15px;
      overflow-x: hidden;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: rgba(16, 16, 32, 0.98);
      border-radius: 25px;
      overflow: hidden;
      border: 2px solid rgba(0, 255, 157, 0.2);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    }

    .header {
      background: linear-gradient(135deg, #00ff9d 0%, #00b8ff 100%);
      padding: 30px 20px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .logo {
      font-size: 48px;
      font-weight: 900;
      letter-spacing: 8px;
      color: #0a0a0a;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      position: relative;
      z-index: 1;
      margin-bottom: 5px;
    }

    .badge {
      position: absolute;
      top: 20px;
      right: 20px;
      background: linear-gradient(45deg, #ff0080, #ff8c00);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: bold;
      z-index: 2;
      box-shadow: 0 4px 15px rgba(255, 0, 128, 0.4);
    }

    .expiration-banner {
      background: linear-gradient(90deg, #ff0000, #ff4500);
      padding: 12px;
      text-align: center;
      font-weight: bold;
      font-size: 14px;
      animation: expirationPulse 2s ease-in-out infinite;
    }

    @keyframes expirationPulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .locked-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      flex-direction: column;
      text-align: center;
    }

    .locked-overlay.active {
      display: flex;
    }

    .locked-content {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      padding: 40px;
      border-radius: 20px;
      border: 3px solid #ff0000;
      max-width: 500px;
      margin: 20px;
    }

    .locked-icon {
      font-size: 64px;
      margin-bottom: 20px;
    }

    .locked-title {
      font-size: 28px;
      font-weight: bold;
      color: #ff0000;
      margin-bottom: 15px;
    }

    .locked-message {
      font-size: 16px;
      line-height: 1.6;
      margin-bottom: 20px;
      opacity: 0.9;
    }

    .locked-timer {
      font-size: 32px;
      font-weight: bold;
      color: #00ff9d;
      margin: 15px 0;
    }

    .locked-contact {
      font-size: 14px;
      opacity: 0.7;
      margin-top: 20px;
    }

    .alert-banner {
      background: linear-gradient(90deg, #ff0080, #ff8c00);
      padding: 15px;
      text-align: center;
      font-weight: bold;
      font-size: 16px;
      display: none;
      animation: alertPulse 1s ease-in-out infinite;
    }

    .alert-banner.active {
      display: block;
    }

    @keyframes alertPulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .status-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      background: rgba(0, 255, 157, 0.05);
      margin: 15px;
      border-radius: 15px;
      border-left: 4px solid #00ff9d;
      flex-wrap: wrap;
      gap: 10px;
    }

    .status-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
    }

    .accuracy-panel {
      background: linear-gradient(135deg, rgba(0, 255, 157, 0.1), rgba(0, 184, 255, 0.1));
      padding: 25px;
      margin: 15px;
      border-radius: 20px;
      border: 2px solid rgba(0, 255, 157, 0.3);
    }

    .accuracy-title {
      text-align: center;
      font-size: 14px;
      opacity: 0.8;
      margin-bottom: 20px;
      letter-spacing: 2px;
    }

    .accuracy-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
    }

    .accuracy-card {
      background: rgba(255, 255, 255, 0.05);
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .accuracy-value {
      font-size: 36px;
      font-weight: 900;
      margin: 10px 0;
    }

    .accuracy-value.success {
      color: #00ff9d;
    }

    .accuracy-value.error {
      color: #ff0080;
    }

    .accuracy-value.rate {
      background: linear-gradient(135deg, #00ff9d, #00b8ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .accuracy-label {
      font-size: 11px;
      opacity: 0.7;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .chart-panel {
      background: rgba(16, 16, 32, 0.9);
      padding: 25px;
      margin: 15px;
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .chart-title {
      text-align: center;
      font-size: 14px;
      opacity: 0.8;
      margin-bottom: 20px;
      letter-spacing: 2px;
    }

    .chart-container {
      display: flex;
      align-items: flex-end;
      justify-content: center;
      gap: 8px;
      height: 150px;
      padding: 20px 10px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 15px;
      overflow-x: auto;
    }

    .chart-bar {
      min-width: 25px;
      border-radius: 8px 8px 0 0;
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      animation: barGrow 0.5s ease;
    }

    @keyframes barGrow {
      from { height: 0; }
    }

    .chart-bar.par {
      background: linear-gradient(180deg, #00b09b 0%, #96c93d 100%);
    }

    .chart-bar.impar {
      background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
    }

    .chart-bar:hover {
      opacity: 0.8;
      transform: scaleY(1.05);
    }

    .chart-legend {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-top: 25px;
      padding-top: 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 13px;
    }

    .legend-color {
      width: 20px;
      height: 20px;
      border-radius: 5px;
    }

    .legend-color.par {
      background: linear-gradient(135deg, #00b09b, #96c93d);
    }

    .legend-color.impar {
      background: linear-gradient(135deg, #667eea, #764ba2);
    }

    .timer-section {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      padding: 25px;
      margin: 15px;
      border-radius: 20px;
      text-align: center;
      border: 2px solid rgba(0, 184, 255, 0.3);
    }

    .timer-label {
      font-size: 12px;
      opacity: 0.7;
      margin-bottom: 10px;
      letter-spacing: 2px;
    }

    .timer {
      font-size: 56px;
      font-weight: 900;
      background: linear-gradient(135deg, #00ff9d, #00b8ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 10px 0;
    }

    .next-time {
      font-size: 13px;
      color: #00b8ff;
      margin-top: 10px;
    }

    .controls-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      padding: 15px;
      margin: 15px;
    }

    .btn-control {
      padding: 30px 20px;
      border: none;
      border-radius: 20px;
      font-size: 24px;
      font-weight: 900;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .btn-control:active {
      transform: scale(0.95);
    }

    .btn-par {
      background: linear-gradient(135deg, #00b09b 0%, #96c93d 100%);
      color: white;
      box-shadow: 0 8px 25px rgba(0, 176, 155, 0.4);
    }

    .btn-par:hover {
      box-shadow: 0 12px 35px rgba(0, 176, 155, 0.6);
      transform: translateY(-2px);
    }

    .btn-impar {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }

    .btn-impar:hover {
      box-shadow: 0 12px 35px rgba(102, 126, 234, 0.6);
      transform: translateY(-2px);
    }

    .confirmation-panel {
      background: rgba(255, 255, 255, 0.05);
      padding: 20px;
      margin: 15px;
      border-radius: 15px;
      border: 2px solid rgba(255, 140, 0, 0.3);
      display: none;
    }

    .confirmation-panel.active {
      display: block;
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .confirmation-title {
      text-align: center;
      font-size: 16px;
      margin-bottom: 15px;
      color: #ff8c00;
      font-weight: bold;
    }

    .confirmation-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .btn-confirm {
      padding: 15px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-confirm.correct {
      background: linear-gradient(135deg, #00ff9d, #00b09b);
      color: white;
    }

    .btn-confirm.wrong {
      background: linear-gradient(135deg, #ff0080, #ff4500);
      color: white;
    }

    .btn-confirm:hover {
      transform: scale(1.05);
    }

    .analysis-panel {
      background: rgba(16, 16, 32, 0.8);
      padding: 30px 20px;
      margin: 15px;
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .analysis-header {
      text-align: center;
      margin-bottom: 25px;
    }

    .analysis-title {
      font-size: 14px;
      opacity: 0.7;
      letter-spacing: 3px;
      margin-bottom: 15px;
    }

    .confidence-display {
      font-size: 72px;
      font-weight: 900;
      background: linear-gradient(135deg, #ff0080, #ff8c00);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 20px 0;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }

    .suggestion-box {
      background: rgba(0, 255, 157, 0.1);
      border: 2px solid #00ff9d;
      border-radius: 15px;
      padding: 25px;
      margin: 20px 0;
      text-align: center;
    }

    .suggestion-label {
      font-size: 12px;
      opacity: 0.7;
      margin-bottom: 10px;
      letter-spacing: 2px;
    }

    .suggestion-value {
      font-size: 32px;
      font-weight: 900;
      color: #00ff9d;
      margin: 10px 0;
    }

    .suggestion-confidence {
      font-size: 14px;
      color: #00b8ff;
    }

    .factors-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 15px;
      margin: 25px 0;
    }

    .factor-card {
      background: linear-gradient(135deg, rgba(0, 255, 157, 0.05), rgba(0, 184, 255, 0.05));
      padding: 20px;
      border-radius: 15px;
      border-left: 4px solid #00ff9d;
      transition: all 0.3s ease;
    }

    .factor-card:hover {
      transform: translateX(5px);
      border-left-color: #00b8ff;
    }

    .factor-icon {
      font-size: 24px;
      margin-bottom: 10px;
    }

    .factor-title {
      font-size: 13px;
      font-weight: 700;
      color: #00ff9d;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .factor-description {
      font-size: 13px;
      opacity: 0.9;
      line-height: 1.5;
    }

    .strategies-summary {
      background: rgba(255, 255, 255, 0.05);
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      margin-top: 20px;
      border: 1px solid rgba(0, 184, 255, 0.2);
    }

    .strategies-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 8px;
      margin-top: 15px;
    }

    .strategy-card {
      background: rgba(255, 255, 255, 0.03);
      padding: 12px;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      text-align: center;
    }

    .strategy-name {
      font-size: 10px;
      opacity: 0.8;
      margin-bottom: 4px;
    }

    .strategy-weight {
      font-size: 14px;
      font-weight: bold;
      color: #00ff9d;
      margin: 3px 0;
    }

    .strategy-success {
      font-size: 10px;
      color: #00b8ff;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      padding: 15px;
      margin: 15px;
    }

    .stat-card {
      background: rgba(255, 255, 255, 0.05);
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .stat-value {
      font-size: 32px;
      font-weight: 900;
      color: #00ff9d;
      margin: 10px 0;
    }

    .stat-label {
      font-size: 11px;
      opacity: 0.7;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .action-buttons {
      display: flex;
      gap: 10px;
      padding: 15px;
      flex-wrap: wrap;
    }

    .btn-action {
      flex: 1;
      min-width: 150px;
      padding: 15px 20px;
      border: 2px solid rgba(0, 184, 255, 0.3);
      background: rgba(0, 184, 255, 0.1);
      color: #00b8ff;
      border-radius: 12px;
      font-size: 13px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .btn-action:hover {
      background: rgba(0, 184, 255, 0.2);
      border-color: #00b8ff;
      transform: translateY(-2px);
    }

    .top-strategies {
      background: rgba(255, 255, 255, 0.05);
      padding: 20px;
      border-radius: 15px;
      margin: 15px;
      border: 1px solid rgba(0, 184, 255, 0.2);
    }

    .top-strategies-title {
      text-align: center;
      font-size: 14px;
      opacity: 0.8;
      margin-bottom: 15px;
      letter-spacing: 2px;
    }

    .top-strategies-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 10px;
    }

    .top-strategy-item {
      background: rgba(255, 255, 255, 0.03);
      padding: 12px;
      border-radius: 8px;
      border-left: 3px solid #00ff9d;
    }

    @media (max-width: 768px) {
      .logo {
        font-size: 36px;
        letter-spacing: 4px;
      }

      .timer {
        font-size: 42px;
      }

      .confidence-display {
        font-size: 56px;
      }

      .btn-control {
        padding: 25px 15px;
        font-size: 20px;
      }

      .factors-grid {
        grid-template-columns: 1fr;
      }

      .strategies-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>
  <!-- OVERLAY DE BLOQUEIO -->
  <div class="locked-overlay" id="locked-overlay">
    <div class="locked-content">
      <div class="locked-icon">üîí</div>
      <div class="locked-title">LICEN√áA EXPIRADA</div>
      <div class="locked-message">
        O per√≠odo de teste de 30 dias terminou. 
        Para continuar usando o sistema LOKI completo com 28 estrat√©gias adaptativas, 
        entre em contato para adquirir uma licen√ßa permanente.
      </div>
      <div class="locked-timer" id="expired-timer">EXPIRADO</div>
      <div class="locked-contact">
        üìß Contato: seu-email@provedor.com<br>
        üì± WhatsApp: (11) 99999-9999
      </div>
    </div>
  </div>

  <div class="container">
    <div class="header">
      <div class="badge">DEMO 30 DIAS</div>
      <div class="logo">L O K I</div>
    </div>

    <!-- BANNER DE EXPIRA√á√ÉO -->
    <div class="expiration-banner" id="expiration-banner">
      ‚è∞ DEMO - Expira em: <span id="days-left">30</span> dias | <span id="expiration-date">--/--/----</span>
    </div>

    <div class="alert-banner" id="alert-banner">
      üö® OPORTUNIDADE DETECTADA - CONFIAN√áA ALTA! üö®
    </div>

    <div class="status-bar">
      <div class="status-item">
        <span>‚ö°</span>
        <span id="status-text">Sistema completo 28 estrat√©gias</span>
      </div>
      <div class="status-item">
        <span>üìä</span>
        <span><span id="total-records">0</span> registros</span>
      </div>
      <div class="status-item">
        <span>üéØ</span>
        <span id="accuracy-display">--%</span>
      </div>
      <div class="status-item">
        <span>ü§ñ</span>
        <span id="active-strategies">0 estrat√©gias</span>
      </div>
    </div>

    <div class="accuracy-panel">
      <div class="accuracy-title">üìä SISTEMA DE ASSERTIVIDADE</div>
      <div class="accuracy-grid">
        <div class="accuracy-card">
          <div class="accuracy-value success" id="hits">0</div>
          <div class="accuracy-label">‚úì Acertos</div>
        </div>
        <div class="accuracy-card">
          <div class="accuracy-value error" id="misses">0</div>
          <div class="accuracy-label">‚úó Erros</div>
        </div>
        <div class="accuracy-card">
          <div class="accuracy-value rate" id="hit-rate">0%</div>
          <div class="accuracy-label">Taxa de Acerto</div>
        </div>
        <div class="accuracy-card">
          <div class="accuracy-value" style="color: #00b8ff;" id="predictions">0</div>
          <div class="accuracy-label">Previs√µes Feitas</div>
        </div>
      </div>
    </div>

    <div class="top-strategies">
      <div class="top-strategies-title">üèÜ ESTRAT√âGIAS MAIS INFLUENTES</div>
      <div class="top-strategies-list" id="top-strategies-list">
        <!-- Estrat√©gias ser√£o inseridas dinamicamente -->
      </div>
    </div>

    <div class="chart-panel">
      <div class="chart-title">üìà HIST√ìRICO VISUAL (√öLTIMOS 20)</div>
      <div class="chart-container" id="chart-container">
        <div style="text-align: center; opacity: 0.5; width: 100%;">Aguardando dados...</div>
      </div>
      <div class="chart-legend">
        <div class="legend-item">
          <div class="legend-color par"></div>
          <span>PAR</span>
        </div>
        <div class="legend-item">
          <div class="legend-color impar"></div>
          <span>√çMPAR</span>
        </div>
      </div>
    </div>

    <div class="timer-section">
      <div class="timer-label">PR√ìXIMO RESULTADO EM</div>
      <div class="timer" id="timer">--s</div>
      <div class="next-time">‚è∞ <span id="next-time">--:--:--</span></div>
    </div>

    <div class="controls-grid">
      <button class="btn-control btn-par" id="btn-par">PAR</button>
      <button class="btn-control btn-impar" id="btn-impar">√çMPAR</button>
    </div>

    <div class="confirmation-panel" id="confirmation-panel">
      <div class="confirmation-title">Confirmar Resultado</div>
      <div class="confirmation-buttons">
        <button class="btn-confirm correct" id="btn-correct">‚úì Correto</button>
        <button class="btn-confirm wrong" id="btn-wrong">‚úó Errado</button>
      </div>
    </div>

    <div class="analysis-panel">
      <div class="analysis-header">
        <div class="analysis-title">AN√ÅLISE INTELIGENTE COMPLETA</div>
        <div class="confidence-display" id="confidence-display">--%</div>
        <div class="suggestion-box">
          <div class="suggestion-label">SUGEST√ÉO DO SISTEMA</div>
          <div class="suggestion-value" id="suggestion-value">--</div>
          <div class="suggestion-confidence" id="suggestion-confidence">Baseado em 28 estrat√©gias adaptativas</div>
        </div>
      </div>

      <div class="strategies-summary">
        <div style="font-size: 13px; opacity: 0.7; margin-bottom: 15px;">TODAS AS 28 ESTRAT√âGIAS ADAPTATIVAS</div>
        <div class="strategies-grid" id="strategies-grid">
          <!-- Estrat√©gias ser√£o inseridas dinamicamente -->
        </div>
      </div>

      <div class="factors-grid" id="factors-grid">
        <!-- Fatores ser√£o inseridos dinamicamente -->
      </div>
    </div>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value" id="total-strategies">0</div>
        <div class="stat-label">Total Estrat√©gias</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="active-now">0</div>
        <div class="stat-label">Ativas Agora</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="best-strategy">--</div>
        <div class="stat-label">Melhor Estrat√©gia</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="avg-success">--%</div>
        <div class="stat-label">M√©dia de Sucesso</div>
      </div>
    </div>

    <div class="action-buttons">
      <button class="btn-action" id="btn-reset">üîÑ Resetar Dados</button>
      <button class="btn-action" id="btn-simulate">ü§ñ Simular 20 Rodadas</button>
      <button class="btn-action" id="btn-export">üì§ Exportar Dados</button>
      <button class="btn-action" id="btn-details">üìä Ver Detalhes</button>
    </div>
  </div>

  <script>
    // =============================================
    // SISTEMA DE SEGURAN√áA COM CHECKSUM - VERS√ÉO CORRIGIDA
    // =============================================

    const SECURITY_CONFIG = {
      SALT: 'LOKI_SECURE_SYSTEM_2024_V3_STABLE', // Texto secreto
      VALIDATION_KEY: 'loki_validation_hash',
      VALIDATION_COUNT: 'loki_validation_count'
    };

    const EXPIRATION_CONFIG = {
      DAYS_TOTAL: 30,
      START_DATE_KEY: 'loki_start_date',
      IS_EXPIRED_KEY: 'loki_expired'
    };

    // Fun√ß√£o para gerar hash de seguran√ßa
    function generateSecurityHash(data) {
      let hash = 0;
      const combinedString = data + SECURITY_CONFIG.SALT;
      
      for (let i = 0; i < combinedString.length; i++) {
        const char = combinedString.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash; // Convert to 32bit integer
      }
      
      // Adiciona complexidade extra baseada no tempo
      const timestamp = Math.floor(Date.now() / (1000 * 60 * 60 * 24)); // Dias desde 1970
      hash = ((hash << 3) - hash) + timestamp;
      
      return Math.abs(hash).toString(36) + timestamp.toString(36);
    }

    // Verificar integridade dos dados - VERS√ÉO TOLERANTE
    function validateSecurityData() {
      const startDate = localStorage.getItem(EXPIRATION_CONFIG.START_DATE_KEY);
      const isExpired = localStorage.getItem(EXPIRATION_CONFIG.IS_EXPIRED_KEY);
      const storedHash = localStorage.getItem(SECURITY_CONFIG.VALIDATION_KEY);
      const validationCount = parseInt(localStorage.getItem(SECURITY_CONFIG.VALIDATION_COUNT) || '0');
      
      // Se n√£o tem dados iniciais, √© a primeira execu√ß√£o - PERMITE
      if (!startDate) {
        console.log('‚úÖ Primeira execu√ß√£o - dados v√°lidos');
        return true;
      }
      
      // Se n√£o tem hash armazenado, mas tem dados - TENTA REPARAR
      if (!storedHash) {
        console.log('‚ö†Ô∏è Hash n√£o encontrado - reparando automaticamente');
        updateSecurityHash();
        return true;
      }
      
      // Gerar hash esperado com os dados atuais
      const expectedHash = generateSecurityHash(startDate + isExpired + validationCount);
      
      // Se o hash n√£o bate, tenta reparar em vez de bloquear
      if (storedHash !== expectedHash) {
        console.log('‚ö†Ô∏è Hash inv√°lido - tentando reparar:', {
          stored: storedHash,
          expected: expectedHash
        });
        
        // Verifica se a data √© v√°lida antes de reparar
        try {
          const start = new Date(startDate);
          if (isNaN(start.getTime())) {
            console.log('‚ùå Data inv√°lida - resetando dados');
            resetExpirationData();
            return true;
          }
          
          // Tenta reparar o hash
          updateSecurityHash();
          console.log('‚úÖ Hash reparado com sucesso');
          return true;
        } catch (error) {
          console.log('‚ùå Erro ao reparar - resetando dados');
          resetExpirationData();
          return true;
        }
      }
      
      console.log('‚úÖ Dados de seguran√ßa v√°lidos');
      return true;
    }

    // Resetar dados de expira√ß√£o
    function resetExpirationData() {
      const newStartDate = new Date().toISOString();
      localStorage.setItem(EXPIRATION_CONFIG.START_DATE_KEY, newStartDate);
      localStorage.setItem(EXPIRATION_CONFIG.IS_EXPIRED_KEY, 'false');
      updateSecurityHash();
      console.log('‚úÖ Dados de expira√ß√£o resetados');
    }

    // Atualizar hash de seguran√ßa
    function updateSecurityHash() {
      const startDate = localStorage.getItem(EXPIRATION_CONFIG.START_DATE_KEY);
      const isExpired = localStorage.getItem(EXPIRATION_CONFIG.IS_EXPIRED_KEY);
      const validationCount = parseInt(localStorage.getItem(SECURITY_CONFIG.VALIDATION_COUNT) || '0') + 1;
      
      localStorage.setItem(SECURITY_CONFIG.VALIDATION_COUNT, validationCount.toString());
      
      const newHash = generateSecurityHash(startDate + isExpired + validationCount);
      localStorage.setItem(SECURITY_CONFIG.VALIDATION_KEY, newHash);
      
      console.log('üîí Hash de seguran√ßa atualizado');
    }

    // =============================================
    // SISTEMA DE EXPIRA√á√ÉO - VERS√ÉO CORRIGIDA E TOLERANTE
    // =============================================

    function initializeExpirationSystem() {
      console.log('üîç Iniciando verifica√ß√£o de expira√ß√£o...');
      
      // ‚úÖ VERIFICA√á√ÉO TOLERANTE: Tenta reparar em vez de bloquear
      if (!validateSecurityData()) {
        console.log('‚ö†Ô∏è Problema nos dados, mas continuando com reparo...');
        // Continua mesmo com problemas para evitar bloqueio falso
      }
      
      let startDate = localStorage.getItem(EXPIRATION_CONFIG.START_DATE_KEY);
      const isExpired = localStorage.getItem(EXPIRATION_CONFIG.IS_EXPIRED_KEY) === 'true';

      // Se √© a primeira vez usando, seta a data de in√≠cio E o hash
      if (!startDate) {
        startDate = new Date().toISOString();
        localStorage.setItem(EXPIRATION_CONFIG.START_DATE_KEY, startDate);
        localStorage.setItem(EXPIRATION_CONFIG.IS_EXPIRED_KEY, 'false');
        updateSecurityHash();
        console.log('‚úÖ Sistema inicializado - data:', startDate);
      }

      // Verifica se j√° est√° marcado como expirado
      if (isExpired) {
        console.log('üîí Sistema marcado como expirado - verificando data real...');
        // Verifica se realmente expirou pela data
        const start = new Date(startDate);
        const now = new Date();
        const diffTime = now - start;
        const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
        const daysLeft = EXPIRATION_CONFIG.DAYS_TOTAL - diffDays;
        
        if (daysLeft > 0) {
          // Ainda tem dias, mas estava marcado como expirado - CORRIGE
          console.log('‚úÖ Corrigindo status - ainda tem', daysLeft, 'dias');
          localStorage.setItem(EXPIRATION_CONFIG.IS_EXPIRED_KEY, 'false');
          updateSecurityHash();
        } else {
          // Realmente expirou
          console.log('‚ùå Sistema expirado de verdade');
          activateLockdown();
          return false;
        }
      }

      // Calcula dias restantes
      const start = new Date(startDate);
      const now = new Date();
      
      // Verifica se a data √© v√°lida
      if (isNaN(start.getTime())) {
        console.log('‚ùå Data inv√°lida - resetando...');
        resetExpirationData();
        return true;
      }
      
      const diffTime = now - start;
      const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
      const daysLeft = EXPIRATION_CONFIG.DAYS_TOTAL - diffDays;

      console.log('üìÖ Dias restantes:', daysLeft);

      // Atualizar hash de seguran√ßa periodicamente (20% de chance)
      if (Math.random() < 0.2) {
        updateSecurityHash();
      }

      // Verifica se expirou
      if (daysLeft <= 0) {
        console.log('‚ùå Per√≠odo de teste expirado');
        localStorage.setItem(EXPIRATION_CONFIG.IS_EXPIRED_KEY, 'true');
        updateSecurityHash();
        activateLockdown();
        return false;
      }

      updateExpirationBanner(daysLeft, start);
      console.log('‚úÖ Sistema ativo -', daysLeft, 'dias restantes');
      return true;
    }

    function updateExpirationBanner(daysLeft, startDate) {
      const banner = document.getElementById('expiration-banner');
      const daysElement = document.getElementById('days-left');
      const dateElement = document.getElementById('expiration-date');

      if (daysLeft > 0) {
        const expirationDate = new Date(startDate);
        expirationDate.setDate(expirationDate.getDate() + EXPIRATION_CONFIG.DAYS_TOTAL);
        
        daysElement.textContent = daysLeft;
        dateElement.textContent = expirationDate.toLocaleDateString('pt-BR');
        
        // Muda cor conforme se aproxima da expira√ß√£o
        if (daysLeft <= 7) {
          banner.style.background = 'linear-gradient(90deg, #ff8c00, #ff4500)';
        } else if (daysLeft <= 15) {
          banner.style.background = 'linear-gradient(90deg, #ffa500, #ff8c00)';
        }
      }
    }

    function activateLockdown() {
      const overlay = document.getElementById('locked-overlay');
      const container = document.querySelector('.container');
      
      // Bloqueio visual
      container.style.filter = 'blur(8px)';
      container.style.pointerEvents = 'none';
      container.style.opacity = '0.7';
      
      // Mostra overlay de bloqueio
      overlay.classList.add('active');
      
      // Desativa todas as funcionalidades
      disableAllFeatures();
      
      console.log('üîí Sistema bloqueado - Licen√ßa expirada');
    }

    function disableAllFeatures() {
      // Desativa bot√µes
      document.getElementById('btn-par').disabled = true;
      document.getElementById('btn-impar').disabled = true;
      document.getElementById('btn-correct').disabled = true;
      document.getElementById('btn-wrong').disabled = true;
      document.getElementById('btn-reset').disabled = true;
      document.getElementById('btn-simulate').disabled = true;
      document.getElementById('btn-export').disabled = true;
      document.getElementById('btn-details').disabled = true;

      // Remove event listeners se necess√°rio
      const buttons = document.querySelectorAll('button');
      buttons.forEach(btn => {
        const oldOnClick = btn.onclick;
        btn.onclick = null;
        if (oldOnClick) btn.onclick = oldOnClick;
      });
    }

    // =============================================
    // SISTEMA COMPLETO - 28 ESTRAT√âGIAS ADAPTATIVAS
    // =============================================

    const lokiData = {
      results: [],
      settings: {
        learningRate: 0.15,
        decayRate: 0.03,
        minWeight: 0.015,
        maxWeight: 0.12,
        historySize: 100,
        performanceWindow: 20,
        confidenceThreshold: 0.65
      },
      metrics: {
        totalPredictions: 0,
        correctPredictions: 0,
        incorrectPredictions: 0,
        currentStreak: 0,
        bestStreak: 0
      }
    };

    // =============================================
    // INICIALIZA√á√ÉO DAS 28 ESTRAT√âGIAS
    // =============================================

    function initializeStrategies() {
      return {
        // --- ESTRAT√âGIAS B√ÅSICAS (8) ---
        triple: {
          name: "Padr√£o Triplo", icon: "üé∞", minData: 3,
          description: "3 resultados iguais consecutivos ‚Üí revers√£o",
          baseWeight: 0.05, currentWeight: 0.05, history: [], successRate: 0, lastPrediction: null
        },
        sandwich: {
          name: "Padr√£o Sandu√≠che", icon: "ü•™", minData: 3,
          description: "Padr√£o A-B-A ‚Üí continua B",
          baseWeight: 0.045, currentWeight: 0.045, history: [], successRate: 0, lastPrediction: null
        },
        alternation: {
          name: "Padr√£o Altern√¢ncia", icon: "üîÑ", minData: 2,
          description: "A-B ‚Üí continua B",
          baseWeight: 0.04, currentWeight: 0.04, history: [], successRate: 0, lastPrediction: null
        },
        reversion: {
          name: "Revers√£o √† M√©dia", icon: "üìâ", minData: 10,
          description: "Desbalanceamento estat√≠stico ‚Üí corre√ß√£o",
          baseWeight: 0.045, currentWeight: 0.045, history: [], successRate: 0, lastPrediction: null
        },
        zigzag: {
          name: "Padr√£o ZigZag", icon: "üîÄ", minData: 4,
          description: "4 altern√¢ncias perfeitas ‚Üí revers√£o",
          baseWeight: 0.04, currentWeight: 0.04, history: [], successRate: 0, lastPrediction: null
        },
        chess: {
          name: "Padr√£o Xadrez", icon: "‚ôüÔ∏è", minData: 4,
          description: "A-A-B-B ‚Üí revers√£o",
          baseWeight: 0.035, currentWeight: 0.035, history: [], successRate: 0, lastPrediction: null
        },
        momentum: {
          name: "Detector Momentum", icon: "‚ö°", minData: 6,
          description: "Alta/baixa altern√¢ncia ‚Üí revers√£o/continua√ß√£o",
          baseWeight: 0.04, currentWeight: 0.04, history: [], successRate: 0, lastPrediction: null
        },
        sequence: {
          name: "Sequ√™ncia Longa", icon: "üìä", minData: 5,
          description: "3+ iguais ‚Üí revers√£o",
          baseWeight: 0.045, currentWeight: 0.045, history: [], successRate: 0, lastPrediction: null
        },

        // --- ESTRAT√âGIAS AVAN√áADAS (20) ---
        pattern: {
          name: "Scanner Padr√µes", icon: "üîç", minData: 9,
          description: "Padr√µes repetitivos no hist√≥rico",
          baseWeight: 0.035, currentWeight: 0.035, history: [], successRate: 0, lastPrediction: null
        },
        wave: {
          name: "Padr√£o Onda", icon: "üåä", minData: 7,
          description: "Ciclos 2x2 ‚Üí revers√£o",
          baseWeight: 0.03, currentWeight: 0.03, history: [], successRate: 0, lastPrediction: null
        },
        mirror: {
          name: "Padr√£o Espelho", icon: "ü™û", minData: 5,
          description: "A-B-A-B-A ‚Üí revers√£o",
          baseWeight: 0.03, currentWeight: 0.03, history: [], successRate: 0, lastPrediction: null
        },
        rupture: {
          name: "Margem Ruptura", icon: "üí•", minData: 8,
          description: "Sequ√™ncia muito longa ‚Üí continua",
          baseWeight: 0.035, currentWeight: 0.035, history: [], successRate: 0, lastPrediction: null
        },
        probabilistic: {
          name: "An√°lise Prob.", icon: "üìà", minData: 8,
          description: "Desbalanceamento geral ‚Üí corre√ß√£o",
          baseWeight: 0.04, currentWeight: 0.04, history: [], successRate: 0, lastPrediction: null
        },
        dollar: {
          name: "Estrat√©gia D√≥lar", icon: "üíµ", minData: 3,
          description: "Minutos especiais ‚Üí continua√ß√£o",
          baseWeight: 0.025, currentWeight: 0.025, history: [], successRate: 0, lastPrediction: null
        },
        doubleSequence: {
          name: "Sequ√™ncia Dupla", icon: "üîÅ", minData: 8,
          description: "A-A-B-B-C-C-D-D ‚Üí revers√£o",
          baseWeight: 0.03, currentWeight: 0.03, history: [], successRate: 0, lastPrediction: null
        },
        lastFive: {
          name: "Domin√¢ncia 5", icon: "üéØ", minData: 5,
          description: "4/5 iguais ‚Üí revers√£o",
          baseWeight: 0.035, currentWeight: 0.035, history: [], successRate: 0, lastPrediction: null
        },
        fourPattern: {
          name: "Padr√£o Qu√°druplo", icon: "4Ô∏è‚É£", minData: 4,
          description: "P-I-I-P / I-P-P-I ‚Üí revers√£o",
          baseWeight: 0.03, currentWeight: 0.03, history: [], successRate: 0, lastPrediction: null
        },

        // --- NOVAS ESTRAT√âGIAS (11) ---
        surf: {
          name: "Surf Inteligente", icon: "üèÑ", minData: 3,
          description: "Continua√ß√£o de sequ√™ncias fortes",
          baseWeight: 0.04, currentWeight: 0.04, history: [], successRate: 0, lastPrediction: null
        },
        alternationFull: {
          name: "Alterna√ß√£o Completa", icon: "üîÑ", minData: 3,
          description: "Padr√£o complexo de altern√¢ncia",
          baseWeight: 0.035, currentWeight: 0.035, history: [], successRate: 0, lastPrediction: null
        },
        fourPatternAdvanced: {
          name: "Padr√£o 4x1/4x2", icon: "üéØ", minData: 4,
          description: "Sequ√™ncias espec√≠ficas de 4 resultados",
          baseWeight: 0.03, currentWeight: 0.03, history: [], successRate: 0, lastPrediction: null
        },
        tripleAdvanced: {
          name: "Triplo Avan√ßado", icon: "üé∞", minData: 3,
          description: "Varia√ß√µes do padr√£o triplo",
          baseWeight: 0.035, currentWeight: 0.035, history: [], successRate: 0, lastPrediction: null
        },
        waveAdvanced: {
          name: "Onda 2x2", icon: "üåä", minData: 7,
          description: "Implementa√ß√£o alternativa de onda",
          baseWeight: 0.03, currentWeight: 0.03, history: [], successRate: 0, lastPrediction: null
        },
        sandwichAdvanced: {
          name: "Sandu√≠che Avan√ßado", icon: "ü•™", minData: 3,
          description: "Mais cen√°rios de padr√£o sandu√≠che",
          baseWeight: 0.03, currentWeight: 0.03, history: [], successRate: 0, lastPrediction: null
        },
        ruptureExpanded: {
          name: "Ruptura Expandida", icon: "üí•", minData: 8,
          description: "Mais condi√ß√µes de margem de ruptura",
          baseWeight: 0.03, currentWeight: 0.03, history: [], successRate: 0, lastPrediction: null
        },
        doubleSequenceFull: {
          name: "Double Seq. Completa", icon: "üîÅ", minData: 8,
          description: "Mais padr√µes de sequ√™ncia dupla",
          baseWeight: 0.03, currentWeight: 0.03, history: [], successRate: 0, lastPrediction: null
        },
        momentumExpanded: {
          name: "Momentum Expandido", icon: "‚ö°", minData: 6,
          description: "Mais cen√°rios de momentum",
          baseWeight: 0.035, currentWeight: 0.035, history: [], successRate: 0, lastPrediction: null
        },
        meanReversion: {
          name: "Mean Reversion", icon: "üìä", minData: 15,
          description: "Vers√£o estat√≠stica avan√ßada",
          baseWeight: 0.04, currentWeight: 0.04, history: [], successRate: 0, lastPrediction: null
        },
        patternScannerAdvanced: {
          name: "Pattern Scanner Av.", icon: "üîç", minData: 9,
          description: "Mais algoritmos de busca",
          baseWeight: 0.035, currentWeight: 0.035, history: [], successRate: 0, lastPrediction: null
        }
      };
    }

    let strategies = initializeStrategies();

    // =============================================
    // SISTEMA DE APRENDIZADO ADAPTATIVO
    // =============================================

    function updateAllStrategyWeights(actualResult) {
      let totalWeight = 0;
      const strategyKeys = Object.keys(strategies);
      
      strategyKeys.forEach(key => {
        const strategy = strategies[key];
        
        if (strategy.lastPrediction !== null) {
          const wasCorrect = strategy.lastPrediction === actualResult;
          
          strategy.history.push(wasCorrect);
          if (strategy.history.length > lokiData.settings.performanceWindow) {
            strategy.history.shift();
          }
          
          const recentHistory = strategy.history.slice(-lokiData.settings.performanceWindow);
          const successCount = recentHistory.filter(Boolean).length;
          strategy.successRate = recentHistory.length > 0 ? successCount / recentHistory.length : 0;
          
          if (wasCorrect) {
            const boost = lokiData.settings.learningRate * (1 + strategy.successRate);
            strategy.currentWeight += boost * (1 - strategy.currentWeight);
          } else {
            strategy.currentWeight -= lokiData.settings.learningRate * strategy.currentWeight;
          }
        }
        
        strategy.currentWeight -= lokiData.settings.decayRate * (strategy.currentWeight - strategy.baseWeight);
        strategy.currentWeight = Math.max(
          lokiData.settings.minWeight,
          Math.min(lokiData.settings.maxWeight, strategy.currentWeight)
        );
        
        totalWeight += strategy.currentWeight;
      });
      
      strategyKeys.forEach(key => {
        strategies[key].currentWeight /= totalWeight;
      });
    }

    // =============================================
    // IMPLEMENTA√á√ÉO DAS 28 ESTRAT√âGIAS
    // =============================================

    // ESTRAT√âGIAS ORIGINAIS (17)
    function applyTripleStrategy(history) {
      if (history.length < 3) return null;
      const lastThree = history.slice(-3);
      if (lastThree[0] === lastThree[1] && lastThree[1] === lastThree[2]) {
        return lastThree[0] === 'par' ? 'impar' : 'par';
      }
      return null;
    }

    function applySandwichStrategy(history) {
      if (history.length < 3) return null;
      const lastThree = history.slice(-3);
      if (lastThree[0] === lastThree[2] && lastThree[0] !== lastThree[1]) {
        return lastThree[1];
      }
      return null;
    }

    function applyAlternationStrategy(history) {
      if (history.length < 2) return null;
      const lastTwo = history.slice(-2);
      if (lastTwo[0] !== lastTwo[1]) {
        return lastTwo[1];
      }
      return null;
    }

    function applyReversionStrategy(history) {
      if (history.length < 10) return null;
      const lastTen = history.slice(-10);
      const parCount = lastTen.filter(r => r === 'par').length;
      const imparCount = lastTen.length - parCount;
      if (parCount >= 7) return 'impar';
      if (imparCount >= 7) return 'par';
      return null;
    }

    function applyZigZagStrategy(history) {
      if (history.length < 4) return null;
      const recent = history.slice(-4);
      const isZigZag = recent.every((val, i, arr) => i === 0 || val !== arr[i - 1]);
      if (isZigZag) {
        return recent[recent.length - 1] === 'par' ? 'impar' : 'par';
      }
      return null;
    }

    function applyChessStrategy(history) {
      if (history.length < 4) return null;
      const recent = history.slice(-4);
      if (recent[0] === recent[1] && recent[2] === recent[3] && recent[0] !== recent[2]) {
        return recent[3] === 'par' ? 'impar' : 'par';
      }
      return null;
    }

    function applyMomentumStrategy(history) {
      if (history.length < 6) return null;
      const recent = history.slice(-6);
      let changes = 0;
      for (let i = 1; i < recent.length; i++) {
        if (recent[i] !== recent[i - 1]) changes++;
      }
      if (changes >= 5) return recent[recent.length - 1] === 'par' ? 'impar' : 'par';
      if (changes <= 1) return recent[recent.length - 1];
      return null;
    }

    function applySequenceStrategy(history) {
      if (history.length < 5) return null;
      const lastResult = history[history.length - 1];
      let sequenceLength = 1;
      for (let i = history.length - 2; i >= 0; i--) {
        if (history[i] === lastResult) sequenceLength++;
        else break;
      }
      if (sequenceLength >= 3) return lastResult === 'par' ? 'impar' : 'par';
      return null;
    }

    function applyPatternScannerStrategy(history) {
      if (history.length < 9) return null;
      const pattern = history.slice(-3).join('-');
      let occurrences = 0;
      let nextResult = null;
      for (let i = 0; i <= history.length - 6; i++) {
        const segment = history.slice(i, i + 3).join('-');
        if (segment === pattern && i + 3 < history.length) {
          occurrences++;
          nextResult = history[i + 3];
        }
      }
      if (occurrences >= 2) return nextResult;
      return null;
    }

    function applyWaveStrategy(history) {
      if (history.length < 7) return null;
      const recent = history.slice(-7);
      const wavePattern = recent[0] === recent[1] && recent[2] === recent[3] && 
                         recent[4] === recent[5] && recent[0] !== recent[2];
      if (wavePattern) return recent[5] === 'par' ? 'impar' : 'par';
      return null;
    }

    function applyMirrorStrategy(history) {
      if (history.length < 5) return null;
      const recent = history.slice(-5);
      if (recent[0] === recent[2] && recent[0] === recent[4] && recent[1] === recent[3]) {
        return recent[4] === 'par' ? 'impar' : 'par';
      }
      return null;
    }

    function applyRuptureStrategy(history) {
      if (history.length < 8) return null;
      const recent = history.slice(-8);
      if (recent.every(val => val === recent[0])) return recent[0];
      return null;
    }

    function applyProbabilisticStrategy(history) {
      if (history.length < 8) return null;
      const parCount = history.filter(r => r === 'par').length;
      const imparCount = history.length - parCount;
      const diff = Math.abs(parCount - imparCount);
      if (diff >= 4) return parCount > imparCount ? 'impar' : 'par';
      return null;
    }

    function applyDollarStrategy(history) {
      const minute = new Date().getMinutes();
      if ((minute === 0 || minute === 30) && history.length >= 3) {
        return history[history.length - 1];
      }
      return null;
    }

    function applyDoubleSequenceStrategy(history) {
      if (history.length < 8) return null;
      const recent = history.slice(-8);
      const pattern = recent[0] === recent[1] && recent[2] === recent[3] && 
                     recent[4] === recent[5] && recent[6] === recent[7] &&
                     recent[0] !== recent[2] && recent[2] !== recent[4] && recent[4] !== recent[6];
      if (pattern) return recent[7] === 'par' ? 'impar' : 'par';
      return null;
    }

    function applyLastFiveStrategy(history) {
      if (history.length < 5) return null;
      const lastFive = history.slice(-5);
      const parCount = lastFive.filter(r => r === 'par').length;
      if (parCount >= 4) return 'impar';
      if (parCount <= 1) return 'par';
      return null;
    }

    function applyFourPatternStrategy(history) {
      if (history.length < 4) return null;
      const recent = history.slice(-4);
      if (recent[0] === 'par' && recent[1] === 'impar' && recent[2] === 'impar' && recent[3] === 'par') return 'impar';
      if (recent[0] === 'impar' && recent[1] === 'par' && recent[2] === 'par' && recent[3] === 'impar') return 'par';
      return null;
    }

    // NOVAS ESTRAT√âGIAS (11)
    function applySurfStrategy(history) {
      if (history.length < 3) return null;
      const seq = getCurrentSequence(history);
      if (seq >= 2) return history[history.length - 1];
      return null;
    }

    function applyAlternationFullStrategy(history) {
      if (history.length < 3) return null;
      const recent = history.slice(-3);
      if (recent[0] !== recent[1] && recent[1] !== recent[2] && recent[0] !== recent[2]) {
        return recent[1];
      }
      return null;
    }

    function applyFourPatternAdvancedStrategy(history) {
      if (history.length < 4) return null;
      const recent = history.slice(-4);
      if (recent[0] === 'par' && recent[1] === 'par' && recent[2] === 'impar' && recent[3] === 'impar') return 'par';
      if (recent[0] === 'impar' && recent[1] === 'impar' && recent[2] === 'par' && recent[3] === 'par') return 'impar';
      return null;
    }

    function applyTripleAdvancedStrategy(history) {
      if (history.length < 4) return null;
      const recent = history.slice(-4);
      if (recent[1] === recent[2] && recent[2] === recent[3]) {
        return recent[3] === 'par' ? 'impar' : 'par';
      }
      return null;
    }

    function applyWaveAdvancedStrategy(history) {
      if (history.length < 6) return null;
      const recent = history.slice(-6);
      const wavePattern = recent[0] === recent[1] && recent[2] === recent[3] && recent[4] === recent[5];
      if (wavePattern) return recent[5] === 'par' ? 'impar' : 'par';
      return null;
    }

    function applySandwichAdvancedStrategy(history) {
      if (history.length < 4) return null;
      const recent = history.slice(-4);
      if (recent[1] === recent[3] && recent[0] !== recent[1]) {
        return recent[1];
      }
      return null;
    }

    function applyRuptureExpandedStrategy(history) {
      if (history.length < 6) return null;
      const recent = history.slice(-6);
      const allSame = recent.every(val => val === recent[0]);
      if (allSame) return recent[0];
      return null;
    }

    function applyDoubleSequenceFullStrategy(history) {
      if (history.length < 6) return null;
      const recent = history.slice(-6);
      const pattern = recent[0] === recent[1] && recent[2] === recent[3] && recent[4] === recent[5];
      if (pattern) return recent[5] === 'par' ? 'impar' : 'par';
      return null;
    }

    function applyMomentumExpandedStrategy(history) {
      if (history.length < 5) return null;
      const recent = history.slice(-5);
      let changes = 0;
      for (let i = 1; i < recent.length; i++) {
        if (recent[i] !== recent[i - 1]) changes++;
      }
      if (changes >= 4) return recent[recent.length - 1];
      return null;
    }

    function applyMeanReversionStrategy(history) {
      if (history.length < 15) return null;
      const parCount = history.filter(r => r === 'par').length;
      const total = history.length;
      const parPercent = (parCount / total) * 100;
      if (parPercent > 60) return 'impar';
      if (parPercent < 40) return 'par';
      return null;
    }

    function applyPatternScannerAdvancedStrategy(history) {
      if (history.length < 12) return null;
      const pattern = history.slice(-4).join('-');
      let occurrences = 0;
      let nextResult = null;
      for (let i = 0; i <= history.length - 8; i++) {
        const segment = history.slice(i, i + 4).join('-');
        if (segment === pattern && i + 4 < history.length) {
          occurrences++;
          nextResult = history[i + 4];
        }
      }
      if (occurrences >= 2) return nextResult;
      return null;
    }

    function getCurrentSequence(history) {
      if (history.length === 0) return 0;
      let count = 1;
      const last = history[history.length - 1];
      for (let i = history.length - 2; i >= 0; i--) {
        if (history[i] === last) count++;
        else break;
      }
      return count;
    }

    // =============================================
    // SISTEMA DE PREVIS√ÉO PRINCIPAL
    // =============================================

    function generateUniversalPrediction() {
      let parScore = 0;
      let imparScore = 0;
      const activeStrategies = [];
      
      Object.keys(strategies).forEach(key => {
        strategies[key].lastPrediction = null;
      });
      
      const strategyFunctions = {
        // Estrat√©gias originais
        triple: applyTripleStrategy,
        sandwich: applySandwichStrategy,
        alternation: applyAlternationStrategy,
        reversion: applyReversionStrategy,
        zigzag: applyZigZagStrategy,
        chess: applyChessStrategy,
        momentum: applyMomentumStrategy,
        sequence: applySequenceStrategy,
        pattern: applyPatternScannerStrategy,
        wave: applyWaveStrategy,
        mirror: applyMirrorStrategy,
        rupture: applyRuptureStrategy,
        probabilistic: applyProbabilisticStrategy,
        dollar: applyDollarStrategy,
        doubleSequence: applyDoubleSequenceStrategy,
        lastFive: applyLastFiveStrategy,
        fourPattern: applyFourPatternStrategy,
        
        // Novas estrat√©gias
        surf: applySurfStrategy,
        alternationFull: applyAlternationFullStrategy,
        fourPatternAdvanced: applyFourPatternAdvancedStrategy,
        tripleAdvanced: applyTripleAdvancedStrategy,
        waveAdvanced: applyWaveAdvancedStrategy,
        sandwichAdvanced: applySandwichAdvancedStrategy,
        ruptureExpanded: applyRuptureExpandedStrategy,
        doubleSequenceFull: applyDoubleSequenceFullStrategy,
        momentumExpanded: applyMomentumExpandedStrategy,
        meanReversion: applyMeanReversionStrategy,
        patternScannerAdvanced: applyPatternScannerAdvancedStrategy
      };
      
      Object.keys(strategyFunctions).forEach(strategyKey => {
        const strategy = strategies[strategyKey];
        const prediction = strategyFunctions[strategyKey](lokiData.results);
        
        if (prediction !== null && lokiData.results.length >= strategy.minData) {
          strategy.lastPrediction = prediction;
          activeStrategies.push(strategy);
          
          const weightedScore = strategy.currentWeight * (0.5 + 0.5 * strategy.successRate);
          
          if (prediction === 'par') {
            parScore += weightedScore;
          } else {
            imparScore += weightedScore;
          }
        }
      });
      
      let finalPrediction = null;
      let confidence = 0;
      
      if (parScore > imparScore) {
        finalPrediction = 'par';
        confidence = calculateUniversalConfidence('par', activeStrategies);
      } else if (imparScore > parScore) {
        finalPrediction = 'impar';
        confidence = calculateUniversalConfidence('impar', activeStrategies);
      } else if (activeStrategies.length > 0) {
        const topStrategy = activeStrategies.sort((a, b) => b.currentWeight - a.currentWeight)[0];
        finalPrediction = topStrategy.lastPrediction;
        confidence = topStrategy.successRate * 0.7;
      } else {
        finalPrediction = Math.random() > 0.5 ? 'par' : 'impar';
        confidence = 0.3;
      }
      
      return {
        prediction: finalPrediction,
        confidence: Math.min(0.95, Math.max(0.1, confidence)),
        parScore: parScore,
        imparScore: imparScore,
        activeStrategies: activeStrategies,
        totalStrategies: activeStrategies.length
      };
    }

    function calculateUniversalConfidence(prediction, activeStrategies) {
      let totalWeight = 0;
      let weightedSuccess = 0;
      
      activeStrategies.forEach(strategy => {
        if (strategy.lastPrediction === prediction) {
          totalWeight += strategy.currentWeight;
          weightedSuccess += strategy.currentWeight * strategy.successRate;
        }
      });
      
      return totalWeight > 0 ? weightedSuccess / totalWeight : 0;
    }

    // =============================================
    // SISTEMA DE EXPLICA√á√ÉO
    // =============================================

    function generateUniversalExplanation(predictionResult) {
      const supportingStrategies = predictionResult.activeStrategies
        .filter(s => s.lastPrediction === predictionResult.prediction)
        .sort((a, b) => (b.currentWeight * b.successRate) - (a.currentWeight * a.successRate));
      
      if (supportingStrategies.length === 0) {
        return "Sugest√£o baseada em an√°lise estat√≠stica b√°sica devido √† falta de padr√µes claros.";
      }
      
      const topStrategy = supportingStrategies[0];
      const successRate = Math.round(topStrategy.successRate * 100);
      const recentUses = Math.min(lokiData.settings.performanceWindow, topStrategy.history.length);
      const weightPercent = Math.round(topStrategy.currentWeight * 100);
      
      let explanation = `Sugeri ${predictionResult.prediction.toUpperCase()} principalmente porque "${topStrategy.name}" `;
      
      if (topStrategy.successRate > 0.75) {
        explanation += `tem excelente desempenho (${successRate}% acerto nas √∫ltimas ${recentUses} vezes) `;
      } else if (topStrategy.successRate > 0.6) {
        explanation += `tem bom desempenho (${successRate}% acerto) `;
      } else {
        explanation += `identificou padr√µes relevantes (${successRate}% acerto) `;
      }
      
      explanation += `com influ√™ncia de ${weightPercent}% na decis√£o.`;
      
      const otherStrategies = supportingStrategies.slice(1, 3);
      if (otherStrategies.length > 0) {
        const otherNames = otherStrategies.map(s => s.name).join(', ');
        explanation += ` Estrat√©gias como ${otherNames} tamb√©m apoiam esta decis√£o.`;
      }
      
      if (predictionResult.activeStrategies.length > 8) {
        explanation += ` No total, ${predictionResult.activeStrategies.length} estrat√©gias diferentes foram consideradas.`;
      }
      
      return explanation;
    }

    // =============================================
    // INTERFACE E UTILIT√ÅRIOS
    // =============================================

    function updateUniversalDisplay() {
      document.getElementById('total-records').textContent = lokiData.results.length;
      document.getElementById('hits').textContent = lokiData.metrics.correctPredictions;
      document.getElementById('misses').textContent = lokiData.metrics.incorrectPredictions;
      document.getElementById('predictions').textContent = lokiData.metrics.totalPredictions;
      
      const hitRate = lokiData.metrics.totalPredictions > 0 
        ? Math.round((lokiData.metrics.correctPredictions / lokiData.metrics.totalPredictions) * 100) 
        : 0;
      document.getElementById('hit-rate').textContent = `${hitRate}%`;
      document.getElementById('accuracy-display').textContent = `${hitRate}%`;
      
      const prediction = generateUniversalPrediction();
      const explanation = generateUniversalExplanation(prediction);
      
      document.getElementById('suggestion-value').textContent = prediction.prediction.toUpperCase();
      document.getElementById('suggestion-confidence').textContent = explanation;
      document.getElementById('confidence-display').textContent = `${Math.round(prediction.confidence * 100)}%`;
      document.getElementById('active-strategies').textContent = `${prediction.activeStrategies.length} estrat√©gias`;
      document.getElementById('active-now').textContent = prediction.activeStrategies.length;
      document.getElementById('total-strategies').textContent = Object.keys(strategies).length;
      
      updateStrategyStats(prediction);
      updateChart();
      updateUniversalFactorsGrid(prediction);
      
      const alertBanner = document.getElementById('alert-banner');
      if (prediction.confidence > lokiData.settings.confidenceThreshold) {
        alertBanner.classList.add('active');
      } else {
        alertBanner.classList.remove('active');
      }
    }

    function updateStrategyStats(prediction) {
      const strategiesGrid = document.getElementById('strategies-grid');
      strategiesGrid.innerHTML = '';
      
      const sortedStrategies = Object.values(strategies).sort((a, b) => b.currentWeight - a.currentWeight);
      
      sortedStrategies.forEach(strategy => {
        const isActive = strategy.lastPrediction !== null;
        const successRate = Math.round(strategy.successRate * 100);
        const weightPercent = Math.round(strategy.currentWeight * 100);
        
        strategiesGrid.innerHTML += `
          <div class="strategy-card" style="border-color: ${isActive ? '#00ff9d' : 'rgba(255,255,255,0.1)'};">
            <div class="factor-icon">${strategy.icon}</div>
            <div class="strategy-name">${strategy.name}</div>
            <div class="strategy-weight">${weightPercent}%</div>
            <div class="strategy-success">${successRate}%</div>
          </div>
        `;
      });
      
      updateTopStrategies(prediction);
      
      const bestStrategy = sortedStrategies[0];
      document.getElementById('best-strategy').textContent = bestStrategy.name.split(' ')[0];
      
      const avgSuccess = Math.round(sortedStrategies.reduce((sum, s) => sum + s.successRate, 0) / sortedStrategies.length * 100);
      document.getElementById('avg-success').textContent = `${avgSuccess}%`;
    }

    function updateTopStrategies(prediction) {
      const topList = document.getElementById('top-strategies-list');
      const supportingStrategies = prediction.activeStrategies
        .filter(s => s.lastPrediction === prediction.prediction)
        .sort((a, b) => (b.currentWeight * b.successRate) - (a.currentWeight * a.successRate))
        .slice(0, 4);
      
      if (supportingStrategies.length === 0) {
        topList.innerHTML = '<div style="text-align: center; opacity: 0.5; padding: 20px;">Nenhuma estrat√©gia ativa no momento</div>';
        return;
      }
      
      topList.innerHTML = supportingStrategies.map(strategy => {
        const influence = Math.round(strategy.currentWeight * strategy.successRate * 100);
        const successRate = Math.round(strategy.successRate * 100);
        
        return `
          <div class="top-strategy-item">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
              <span style="font-weight: bold;">${strategy.icon} ${strategy.name}</span>
              <span style="color: #00ff9d; font-weight: bold;">${influence}%</span>
            </div>
            <div style="font-size: 12px; opacity: 0.8;">${strategy.description}</div>
            <div style="font-size: 11px; color: #00b8ff; margin-top: 5px;">
              ${successRate}% acerto | ${Math.round(strategy.currentWeight * 100)}% peso
            </div>
          </div>
        `;
      }).join('');
    }

    function updateUniversalFactorsGrid(prediction) {
      const grid = document.getElementById('factors-grid');
      const factors = [];
      
      factors.push({
        icon: 'üéØ',
        title: 'N√çVEL DE CONFIAN√áA',
        description: `Sistema ${Math.round(prediction.confidence * 100)}% confiante com ${prediction.activeStrategies.length} estrat√©gias ativas.`
      });
      
      factors.push({
        icon: 'ü§ñ',
        title: 'ESTRAT√âGIAS ATIVAS',
        description: `${prediction.activeStrategies.length} de 28 estrat√©gias contribu√≠ram para esta decis√£o.`
      });
      
      factors.push({
        icon: 'üß†',
        title: 'APRENDIZADO CONT√çNUO',
        description: `Todas as 28 estrat√©gias ajustam pesos automaticamente baseado no desempenho.`
      });
      
      if (lokiData.results.length > 0) {
        const lastResult = lokiData.results[lokiData.results.length - 1];
        factors.push({
          icon: 'üìä',
          title: 'CONTEXTO ATUAL',
          description: `√öltimo resultado: ${lastResult.toUpperCase()}. Baseado em ${lokiData.results.length} registros hist√≥ricos.`
        });
      }
      
      grid.innerHTML = factors.map(factor => `
        <div class="factor-card">
          <div class="factor-icon">${factor.icon}</div>
          <div class="factor-title">${factor.title}</div>
          <div class="factor-description">${factor.description}</div>
        </div>
      `).join('');
    }

    function processUniversalResult(result, isUserInput = true) {
      lokiData.results.push(result);
      if (lokiData.results.length > lokiData.settings.historySize) {
        lokiData.results.shift();
      }
      
      if (isUserInput) {
        lokiData.metrics.totalPredictions++;
        const lastPrediction = generateUniversalPrediction();
        if (lastPrediction.prediction === result) {
          lokiData.metrics.correctPredictions++;
          lokiData.metrics.currentStreak++;
          if (lokiData.metrics.currentStreak > lokiData.metrics.bestStreak) {
            lokiData.metrics.bestStreak = lokiData.metrics.currentStreak;
          }
        } else {
          lokiData.metrics.incorrectPredictions++;
          lokiData.metrics.currentStreak = 0;
        }
      }
      
      updateAllStrategyWeights(result);
      saveUniversalData();
      updateUniversalDisplay();
    }

    function saveUniversalData() {
      const dataToSave = {
        results: lokiData.results,
        strategies: strategies,
        metrics: lokiData.metrics,
        settings: lokiData.settings
      };
      localStorage.setItem('lokiUniversalData', JSON.stringify(dataToSave));
    }

    function loadUniversalData() {
      const saved = localStorage.getItem('lokiUniversalData');
      if (saved) {
        const parsed = JSON.parse(saved);
        lokiData.results = parsed.results || [];
        strategies = parsed.strategies || initializeStrategies();
        lokiData.metrics = parsed.metrics || lokiData.metrics;
        lokiData.settings = { ...lokiData.settings, ...parsed.settings };
      }
    }

    function simulateUniversalRounds(count) {
      for (let i = 0; i < count; i++) {
        const result = Math.random() > 0.5 ? 'par' : 'impar';
        processUniversalResult(result, false);
      }
      updateUniversalDisplay();
    }

    function startUniversalTimer() {
      let seconds = 30;
      const timerElement = document.getElementById('timer');
      const nextTimeElement = document.getElementById('next-time');
      
      function updateTimer() {
        timerElement.textContent = `${seconds}s`;
        const now = new Date();
        now.setSeconds(now.getSeconds() + seconds);
        nextTimeElement.textContent = now.toLocaleTimeString();
        seconds--;
        if (seconds < 0) seconds = 30;
      }
      
      updateTimer();
      setInterval(updateTimer, 1000);
    }

    // =============================================
    // INICIALIZA√á√ÉO DO SISTEMA
    // =============================================

    function initializeUniversalSystem() {
      console.log('üöÄ Iniciando sistema LOKI v4.0...');
      
      // Primeiro verifica a expira√ß√£o com a vers√£o tolerante
      const isActive = initializeExpirationSystem();
      
      if (!isActive) {
        console.log('‚ùå Sistema bloqueado - licen√ßa expirada');
        return;
      }

      // Se n√£o estiver expirado, inicializa normalmente
      loadUniversalData();
      updateUniversalDisplay();
      startUniversalTimer();
      
      console.log('‚úÖ Sistema LOKI inicializado com sucesso!');
    }

    // Event Listeners
    document.getElementById('btn-par').addEventListener('click', () => {
      processUniversalResult('par', true);
      showConfirmationPanel();
    });

    document.getElementById('btn-impar').addEventListener('click', () => {
      processUniversalResult('impar', true);
      showConfirmationPanel();
    });

    document.getElementById('btn-correct').addEventListener('click', () => {
      hideConfirmationPanel();
      updateUniversalDisplay();
    });

    document.getElementById('btn-wrong').addEventListener('click', () => {
      hideConfirmationPanel();
      updateUniversalDisplay();
    });

    document.getElementById('btn-reset').addEventListener('click', () => {
      if (confirm('Resetar todos os dados e hist√≥rico de aprendizado?')) {
        lokiData.results = [];
        lokiData.metrics = {
          totalPredictions: 0,
          correctPredictions: 0,
          incorrectPredictions: 0,
          currentStreak: 0,
          bestStreak: 0
        };
        strategies = initializeStrategies();
        saveUniversalData();
        updateUniversalDisplay();
      }
    });

    document.getElementById('btn-simulate').addEventListener('click', () => {
      simulateUniversalRounds(20);
    });

    document.getElementById('btn-export').addEventListener('click', () => {
      const dataStr = JSON.stringify({
        results: lokiData.results,
        strategies: strategies,
        metrics: lokiData.metrics,
        settings: lokiData.settings,
        exported: new Date().toISOString()
      }, null, 2);
      
      const dataBlob = new Blob([dataStr], {type: 'application/json'});
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `loki_completo_${new Date().toISOString().slice(0, 10)}.json`;
      link.click();
      URL.revokeObjectURL(url);
    });

    document.getElementById('btn-details').addEventListener('click', () => {
      const totalStrategies = Object.keys(strategies).length;
      const activeStrategies = Object.values(strategies).filter(s => s.lastPrediction !== null).length;
      const avgSuccess = Math.round(Object.values(strategies).reduce((sum, s) => sum + s.successRate, 0) / totalStrategies * 100);
      
      alert(`üìä SISTEMA COMPLETO - 28 ESTRAT√âGIAS\n\n` +
        `Total de estrat√©gias: ${totalStrategies}\n` +
        `Estrat√©gias ativas agora: ${activeStrategies}\n` +
        `M√©dia de sucesso: ${avgSuccess}%\n` +
        `Total de registros: ${lokiData.results.length}\n` +
        `Previs√µes feitas: ${lokiData.metrics.totalPredictions}\n` +
        `Taxa de acerto: ${lokiData.metrics.totalPredictions > 0 ? 
          Math.round((lokiData.metrics.correctPredictions / lokiData.metrics.totalPredictions) * 100) : 0}%\n` +
        `Melhor sequ√™ncia: ${lokiData.metrics.bestStreak} acertos\n` +
        `Sequ√™ncia atual: ${lokiData.metrics.currentStreak} acertos`);
    });

    function showConfirmationPanel() {
      document.getElementById('confirmation-panel').classList.add('active');
    }

    function hideConfirmationPanel() {
      document.getElementById('confirmation-panel').classList.remove('active');
    }

    function updateChart() {
      const container = document.getElementById('chart-container');
      const lastTwenty = lokiData.results.slice(-20);
      
      if (lastTwenty.length === 0) {
        container.innerHTML = '<div style="text-align: center; opacity: 0.5; width: 100%;">Aguardando dados...</div>';
        return;
      }
      
      container.innerHTML = '';
      
      lastTwenty.forEach((result, index) => {
        const bar = document.createElement('div');
        bar.className = `chart-bar ${result}`;
        const height = 30 + (70 * (index + 1) / lastTwenty.length);
        bar.style.height = `${height}px`;
        bar.title = `#${lokiData.results.length - lastTwenty.length + index + 1}: ${result.toUpperCase()}`;
        container.appendChild(bar);
      });
    }

    // Inicializa quando a p√°gina carrega
    document.addEventListener('DOMContentLoaded', initializeUniversalSystem);
  </script>
</body>
</html>